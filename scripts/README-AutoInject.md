# ğŸš€ Stagewise è‡ªåŠ¨æ³¨å…¥å·¥å…·æ ç³»ç»Ÿ

> **ç®€æ´é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆ**ï¼šå°†å·¥å…·æ æºç æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡ŒæœåŠ¡åï¼Œé¡¹ç›®ä¸‹çš„ä»»ä½•ç½‘é¡µéƒ½ä¼šåœ¨å¼€å‘è€…æ¨¡å¼å’Œæµ‹è¯•æ¨¡å¼ä¸‹å³ä¸‹è§’è‡ªåŠ¨å‡ºç°å·¥å…·æ ã€‚

## ğŸ“‹ ç›®å½•

- [ç‰¹æ€§æ¦‚è§ˆ](#ç‰¹æ€§æ¦‚è§ˆ)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [é›†æˆæ–¹å¼](#é›†æˆæ–¹å¼)
- [é…ç½®é€‰é¡¹](#é…ç½®é€‰é¡¹)
- [åŠŸèƒ½è¯¦è§£](#åŠŸèƒ½è¯¦è§£)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)

## âœ¨ ç‰¹æ€§æ¦‚è§ˆ

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§
- **ğŸ”„ è‡ªåŠ¨æ³¨å…¥**ï¼šæ— éœ€æ‰‹åŠ¨ä¿®æ”¹HTMLï¼Œè‡ªåŠ¨åœ¨æ‰€æœ‰é¡µé¢æ³¨å…¥å·¥å…·æ 
- **ğŸŒ é€šç”¨å…¼å®¹**ï¼šæ”¯æŒä»»ä½•Express.jsé¡¹ç›®ï¼Œæ— è®ºæŠ€æœ¯æ ˆ
- **ğŸš¦ æ™ºèƒ½æ˜¾ç¤º**ï¼šåªåœ¨å¼€å‘/æµ‹è¯•æ¨¡å¼ä¸‹æ˜¾ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨éšè—
- **ğŸ¨ ç¾è§‚è®¾è®¡**ï¼šç°ä»£åŒ–UIè®¾è®¡ï¼Œæ¸å˜èƒŒæ™¯ï¼ŒåŠé€æ˜æ•ˆæœ
- **âš¡ é›¶ä¾èµ–**ï¼šå·¥å…·æ ä»£ç å®Œå…¨è‡ªåŒ…å«ï¼Œä¸ä¾èµ–å¤–éƒ¨èµ„æº

### ğŸ› ï¸ å·¥å…·æ åŠŸèƒ½
- **ğŸ” å…ƒç´ æ£€æŸ¥**ï¼šå¿«é€Ÿå¯åŠ¨é¡µé¢å…ƒç´ æ£€æŸ¥æ¨¡å¼
- **ğŸ“„ é¡µé¢ä¿¡æ¯**ï¼šæŸ¥çœ‹å½“å‰é¡µé¢çš„è¯¦ç»†æŠ€æœ¯ä¿¡æ¯
- **ğŸ”§ æ§åˆ¶å°**ï¼šå¿«é€Ÿè®¿é—®å¼€å‘è€…æ§åˆ¶å°å’Œè°ƒè¯•å·¥å…·
- **âš¡ æ€§èƒ½åˆ†æ**ï¼šå®æ—¶åˆ†æé¡µé¢æ€§èƒ½æŒ‡æ ‡å’ŒåŠ è½½æ—¶é—´
- **ğŸ’¾ æ•°æ®å¯¼å‡º**ï¼šå¯¼å‡ºé¡µé¢åˆ†ææŠ¥å‘Šä¸ºJSONæ ¼å¼

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ç»Ÿä¸€å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰

1. **ä¸‹è½½æ ¸å¿ƒæ–‡ä»¶**
```bash
# ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­ï¼š
# - autoInjectToolbar.js      # æ ¸å¿ƒæ³¨å…¥ä¸­é—´ä»¶
# - stagewise-launcher.js     # ç»Ÿä¸€å¯åŠ¨å™¨
# - start-universal.bat       # Windowså¯åŠ¨è„šæœ¬
```

2. **è¿è¡Œå¯åŠ¨å™¨**
```bash
# Windows
åŒå‡» start-universal.bat

# æˆ–æ‰‹åŠ¨è¿è¡Œ
node stagewise-launcher.js
```

3. **é€‰æ‹©æ¨¡å¼**
```
è¯·é€‰æ‹©å¯åŠ¨æ¨¡å¼ï¼š
  1ï¸âƒ£  å¯åŠ¨æµ‹è¯•é¡µé¢æœåŠ¡å™¨ (æ¨è)
  2ï¸âƒ£  å¯åŠ¨é™æ€æ–‡ä»¶æœåŠ¡å™¨  
  3ï¸âƒ£  ç”Ÿæˆä½¿ç”¨è¯´æ˜
  0ï¸âƒ£  é€€å‡º
```

### æ–¹å¼äºŒï¼šç›´æ¥é›†æˆåˆ°ç°æœ‰é¡¹ç›®

1. **å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶**
```bash
cp autoInjectToolbar.js /your/project/root/
```

2. **ä¿®æ”¹é¡¹ç›®ä»£ç **
```javascript
// åœ¨ä½ çš„Expressåº”ç”¨ä¸­æ·»åŠ 
const { createAutoInjectMiddleware } = require('./autoInjectToolbar');

const app = express();

// æ·»åŠ è¿™ä¸€è¡Œï¼ˆè¶Šæ—©è¶Šå¥½ï¼‰
app.use(createAutoInjectMiddleware());

// å…¶ä»–ä¸­é—´ä»¶å’Œè·¯ç”±...
```

3. **å¯åŠ¨é¡¹ç›®**
```bash
npm start
# æˆ–
node server.js
```

## ğŸ”§ é›†æˆæ–¹å¼

### Express.js é›†æˆï¼ˆæ¨èï¼‰

```javascript
/**
 * å®Œæ•´çš„Express.jsé›†æˆç¤ºä¾‹
 */
const express = require('express');
const { createAutoInjectMiddleware } = require('./autoInjectToolbar');

const app = express();

// 1. é¦–å…ˆåº”ç”¨Stagewiseä¸­é—´ä»¶
app.use(createAutoInjectMiddleware());

// 2. ç„¶åæ·»åŠ å…¶ä»–ä¸­é—´ä»¶
app.use(express.static('public'));
app.use(express.json());

// 3. å®šä¹‰è·¯ç”±
app.get('/', (req, res) => {
  res.send('<html><body><h1>Hello World</h1></body></html>');
});

app.listen(3000, () => {
  console.log('æœåŠ¡å™¨å·²å¯åŠ¨ï¼Œå·¥å…·æ å·²è‡ªåŠ¨æ³¨å…¥åˆ°æ‰€æœ‰é¡µé¢');
});
```

### Next.js é›†æˆ

```javascript
// middleware.js
import { NextResponse } from 'next/server';
import { getToolbarCode } from './autoInjectToolbar.js';

export function middleware(request) {
  const response = NextResponse.next();
  
  // åªåœ¨å¼€å‘æ¨¡å¼ä¸‹æ³¨å…¥
  if (process.env.NODE_ENV === 'development') {
    // ä¿®æ”¹HTMLå“åº”æ¥æ³¨å…¥å·¥å…·æ 
    const html = response.body.replace('</body>', getToolbarCode() + '</body>');
    return new NextResponse(html, response);
  }
  
  return response;
}
```

### æ‰‹åŠ¨HTMLæ³¨å…¥

```html
<!DOCTYPE html>
<html>
<head>
    <title>Your Page</title>
</head>
<body>
    <h1>Your Content</h1>
    
    <!-- åœ¨ </body> æ ‡ç­¾å‰æ·»åŠ å·¥å…·æ ä»£ç  -->
    <!-- å¤åˆ¶ autoInjectToolbar.js ä¸­ getToolbarCode() å‡½æ•°çš„è¿”å›å€¼ -->
</body>
</html>
```

## âš™ï¸ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡æ§åˆ¶

```bash
# æ˜¾ç¤ºå·¥å…·æ 
NODE_ENV=development
NODE_ENV=test

# éšè—å·¥å…·æ 
NODE_ENV=production
```

### URLå‚æ•°æ§åˆ¶

```
# å¼ºåˆ¶éšè—å·¥å…·æ 
http://localhost:3000/?stagewise=false

# å¼ºåˆ¶æ˜¾ç¤ºå·¥å…·æ 
http://localhost:3000/?stagewise=true
```

### è‡ªå®šä¹‰é…ç½®

```javascript
// åœ¨ autoInjectToolbar.js ä¸­ä¿®æ”¹
function shouldShowToolbar(req) {
  // è‡ªå®šä¹‰æ˜¾ç¤ºé€»è¾‘
  const nodeEnv = process.env.NODE_ENV;
  const userAgent = req.get('User-Agent');
  
  // ä¾‹ï¼šåªåœ¨ç‰¹å®šæµè§ˆå™¨ä¸­æ˜¾ç¤º
  if (userAgent && userAgent.includes('Chrome')) {
    return nodeEnv !== 'production';
  }
  
  return false;
}
```

## ğŸ¨ åŠŸèƒ½è¯¦è§£

### ğŸ” å…ƒç´ æ£€æŸ¥
- å¯åŠ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„å…ƒç´ æ£€æŸ¥æ¨¡å¼
- å¸®åŠ©å¿«é€Ÿå®šä½å’Œè°ƒè¯•DOMå…ƒç´ 
- æä¾›å…ƒç´ é€‰æ‹©å’Œå±æ€§æŸ¥çœ‹åŠŸèƒ½

### ğŸ“„ é¡µé¢ä¿¡æ¯
æ˜¾ç¤ºè¯¦ç»†çš„é¡µé¢æŠ€æœ¯ä¿¡æ¯ï¼š
- URLã€æ ‡é¢˜ã€åŸŸåã€åè®®
- ç”¨æˆ·ä»£ç†ã€å±å¹•åˆ†è¾¨ç‡ã€è§†å£å¤§å°
- æ–‡æ¡£åŠ è½½çŠ¶æ€ã€Cookieæ•°é‡
- æœ¬åœ°å­˜å‚¨å’Œä¼šè¯å­˜å‚¨ä½¿ç”¨æƒ…å†µ

### âš¡ æ€§èƒ½åˆ†æ
å®æ—¶ç›‘æ§é¡µé¢æ€§èƒ½ï¼š
- é¡µé¢åŠ è½½æ—¶é—´å’Œå“åº”æ—¶é—´
- DOMèŠ‚ç‚¹ã€å›¾ç‰‡ã€è„šæœ¬æ•°é‡ç»Ÿè®¡
- DNSæŸ¥è¯¢ã€TCPè¿æ¥ã€DOMæ„å»ºæ—¶é—´
- æ€§èƒ½APIæ•°æ®åˆ†æ

### ğŸ’¾ æ•°æ®å¯¼å‡º
å¯¼å‡ºå®Œæ•´çš„é¡µé¢åˆ†ææŠ¥å‘Šï¼š
- JSONæ ¼å¼çš„ç»“æ„åŒ–æ•°æ®
- åŒ…å«æ€§èƒ½æŒ‡æ ‡ã€é¡µé¢ä¿¡æ¯ã€æ—¶é—´æˆ³
- ä¾¿äºåç»­åˆ†æå’ŒæŠ¥å‘Šç”Ÿæˆ

## ğŸ› æ•…éšœæ’é™¤

### å·¥å…·æ ä¸æ˜¾ç¤º

**æ£€æŸ¥ç¯å¢ƒå˜é‡**
```bash
echo $NODE_ENV
# åº”è¯¥æ˜¯ development æˆ– test
```

**æ£€æŸ¥æ§åˆ¶å°é”™è¯¯**
```javascript
// æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
console.log('[Stagewise] å·¥å…·æ å·²åŠ è½½');
```

**æ£€æŸ¥æ–‡ä»¶è·¯å¾„**
```bash
# ç¡®ä¿ autoInjectToolbar.js åœ¨æ­£ç¡®ä½ç½®
ls -la autoInjectToolbar.js
```

### å·¥å…·æ åŠŸèƒ½å¼‚å¸¸

**æ£€æŸ¥JavaScripté”™è¯¯**
```javascript
// åœ¨æ§åˆ¶å°æµ‹è¯•å·¥å…·æ å¯¹è±¡
console.log(window.stagewise);
```

**æ£€æŸ¥ç½‘ç»œè¯·æ±‚**
- æ‰“å¼€Networkæ ‡ç­¾æŸ¥çœ‹æ˜¯å¦æœ‰è¯·æ±‚å¤±è´¥
- ç¡®ä¿æ²¡æœ‰CORSæˆ–CSPç­–ç•¥é˜»æ­¢è„šæœ¬æ‰§è¡Œ

### æ ·å¼æ˜¾ç¤ºé—®é¢˜

**æ£€æŸ¥CSSå†²çª**
```css
/* å·¥å…·æ ä½¿ç”¨é«˜z-indexç¡®ä¿åœ¨æœ€é¡¶å±‚ */
#stagewise-toolbar-container {
    z-index: 999999 !important;
}
```

**æ£€æŸ¥å“åº”å¼å…¼å®¹æ€§**
- åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æµ‹è¯•å·¥å…·æ æ˜¾ç¤º
- æ£€æŸ¥ç§»åŠ¨è®¾å¤‡ä¸Šçš„è§¦æ‘¸äº¤äº’

## ğŸ“š æœ€ä½³å®è·µ

### ğŸ¯ æ€§èƒ½ä¼˜åŒ–

1. **æŒ‰éœ€åŠ è½½**
```javascript
// åªåœ¨éœ€è¦æ—¶åˆå§‹åŒ–å·¥å…·æ 
if (shouldShowToolbar(req)) {
    // æ³¨å…¥å·¥å…·æ ä»£ç 
}
```

2. **ç¼“å­˜ä¼˜åŒ–**
```javascript
// ç¼“å­˜å·¥å…·æ ä»£ç é¿å…é‡å¤ç”Ÿæˆ
let cachedToolbarCode = null;
function getToolbarCode() {
    if (!cachedToolbarCode) {
        cachedToolbarCode = generateToolbarCode();
    }
    return cachedToolbarCode;
}
```

### ğŸ”’ å®‰å…¨è€ƒè™‘

1. **ç”Ÿäº§ç¯å¢ƒéš”ç¦»**
```javascript
// ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸æ³¨å…¥å·¥å…·æ 
if (process.env.NODE_ENV === 'production') {
    return next();
}
```

2. **æ•æ„Ÿä¿¡æ¯ä¿æŠ¤**
```javascript
// é¿å…åœ¨å·¥å…·æ ä¸­æ˜¾ç¤ºæ•æ„Ÿä¿¡æ¯
const pageInfo = {
    url: req.url,
    // ä¸åŒ…å«ç”¨æˆ·æ•°æ®æˆ–APIå¯†é’¥
};
```

### ğŸ§ª æµ‹è¯•ç­–ç•¥

1. **è‡ªåŠ¨åŒ–æµ‹è¯•**
```javascript
// æµ‹è¯•å·¥å…·æ æ³¨å…¥åŠŸèƒ½
describe('Stagewise Toolbar', () => {
    it('should inject toolbar in development mode', () => {
        process.env.NODE_ENV = 'development';
        const response = testRequest('/');
        expect(response.body).toContain('stagewise-toolbar');
    });
});
```

2. **æ‰‹åŠ¨æµ‹è¯•æ¸…å•**
- [ ] å·¥å…·æ åœ¨å¼€å‘æ¨¡å¼ä¸‹æ˜¾ç¤º
- [ ] å·¥å…·æ åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹éšè—
- [ ] æ‰€æœ‰åŠŸèƒ½æŒ‰é’®æ­£å¸¸å·¥ä½œ
- [ ] å“åº”å¼è®¾è®¡åœ¨ä¸åŒè®¾å¤‡ä¸Šæ­£å¸¸
- [ ] ä¸ä¸ç°æœ‰é¡µé¢æ ·å¼å†²çª

## ğŸ“ æ”¯æŒä¸å¸®åŠ©

### ğŸ”— ç›¸å…³é“¾æ¥
- **é¡¹ç›®åœ°å€**: https://github.com/lwaaron/stagewise
- **é—®é¢˜åé¦ˆ**: https://x.com/linusorii
- **æ–‡æ¡£ç½‘ç«™**: [å¾…æ›´æ–°]

### ğŸ’¬ å¸¸è§é—®é¢˜

**Q: å·¥å…·æ ä¼šå½±å“é¡µé¢æ€§èƒ½å—ï¼Ÿ**
A: å·¥å…·æ ä»£ç ç»è¿‡ä¼˜åŒ–ï¼Œåªåœ¨å¼€å‘ç¯å¢ƒä¸‹åŠ è½½ï¼Œå¯¹æ€§èƒ½å½±å“æå°ã€‚

**Q: å¯ä»¥è‡ªå®šä¹‰å·¥å…·æ æ ·å¼å—ï¼Ÿ**
A: å¯ä»¥ï¼Œä¿®æ”¹ `autoInjectToolbar.js` ä¸­çš„CSSæ ·å¼å³å¯ã€‚

**Q: æ”¯æŒå“ªäº›æµè§ˆå™¨ï¼Ÿ**
A: æ”¯æŒæ‰€æœ‰ç°ä»£æµè§ˆå™¨ï¼ŒåŒ…æ‹¬Chromeã€Firefoxã€Safariã€Edgeã€‚

**Q: å¦‚ä½•åœ¨å›¢é˜Ÿä¸­å…±äº«é…ç½®ï¼Ÿ**
A: å°† `autoInjectToolbar.js` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå›¢é˜Ÿæˆå‘˜å³å¯å…±äº«åŒæ ·çš„å·¥å…·æ é…ç½®ã€‚

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-XX)
- âœ¨ é¦–ä¸ªç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æ”¯æŒè‡ªåŠ¨æ³¨å…¥åŠŸèƒ½
- ğŸ”§ å®Œæ•´çš„å·¥å…·æ åŠŸèƒ½é›†
- ğŸ“± å“åº”å¼è®¾è®¡æ”¯æŒ
- ğŸŒ è·¨å¹³å°å…¼å®¹æ€§

---

<div align="center">

**ğŸ‰ æ„Ÿè°¢ä½¿ç”¨ Stagewise è‡ªåŠ¨æ³¨å…¥å·¥å…·æ ç³»ç»Ÿï¼**

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ Starï¼

*Made with â¤ï¸ by OctopusDev*

</div> 